<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assign Production Supervisor - Highland Fresh</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="admin-dashboard.html">Highland Fresh</a>
    <div class="ms-auto">
      <a href="admin-dashboard.html" class="btn btn-outline-secondary btn-sm"><i class="bi bi-grid"></i> Dashboard</a>
    </div>
  </div>
</nav>
<div class="container mt-4">
  <h3 class="mb-3">Assign Production Supervisor Role</h3>
  <div class="card">
    <div class="card-body">
      <form id="assignRoleForm" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Select User</label>
          <select id="userSelect" class="form-select" required>
            <option value="">Loading users...</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Role</label>
          <input type="text" class="form-control" value="Production Supervisor" disabled />
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">Assign</button>
        </div>
      </form>
      <div id="assignResult" class="mt-3"></div>
    </div>
  </div>
</div>
<script>
async function loadUsers() {
  try {
    const res = await fetch('../api/UsersAPI.php?action=get_all_users');
    const data = await res.json();
    const sel = document.getElementById('userSelect');
    if (!data.success) throw new Error(data.message || 'Failed');
    sel.innerHTML = '<option value="">Select user...</option>' + data.users.map(u => `<option value="${u.user_id}">${u.username} (${u.role_name || 'n/a'})</option>`).join('');
  } catch (e) {
    document.getElementById('userSelect').innerHTML = '<option value="">Error loading users</option>';
  }
}
document.getElementById('assignRoleForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const userId = document.getElementById('userSelect').value;
  if (!userId) return;
  const resultDiv = document.getElementById('assignResult');
  resultDiv.innerHTML = '<div class="alert alert-info">Assigning role...</div>';
  try {
    const res = await fetch('../api/AdminRolesAPI.php', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({user_id: userId, role_name: 'Production Supervisor'})});
    const data = await res.json();
    if (data.success) {
      resultDiv.innerHTML = '<div class="alert alert-success">Role updated successfully.</div>';
      loadUsers();
    } else {
      throw new Error(data.message);
    }
  } catch (err) {
    resultDiv.innerHTML = `<div class="alert alert-danger">${err.message}</div>`;
  }
});
document.addEventListener('DOMContentLoaded', loadUsers);
</script>
</body>
</html>
